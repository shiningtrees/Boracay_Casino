# 🎰 PROJECT: Boracay Casino Strategy & Backtest Specification

> **Status**: ✅ 백테스트 엔진 구현 완료 (2026-02-14)

## 1. 개요 (Objective)
- 본 프로젝트는 MEXC 거래소의 잡코인 소액 베팅 전략을 자동화한다.
- **-25% 고정 손절**로 바닥 리스크를 방어한다.
- **+25% 수익 시점**부터 **트레일링 스탑(Trailing Stop)**을 가동하여 천장을 뚫는 수익을 추격한다.
- 초기 자산 **100 USDT** 기준, 추가 시드 보충 없이 가장 오래 생존할 수 있는 주기를 검증한다.
- **최종 결정: 72시간 (3일) 주기** ⭐ (2026-02-14)

---

## 2. 실전 매매 로직 (Core Logic Implementation)
✅ **구현 완료** (2026-02-14): `core/config.py`, `core/scheduler_engine.py`

에이전트는 아래 로직을 `core/config.py` 및 `core/scheduler_engine.py`에 반영할 것.

### [설정 변수]
- `STOP_LOSS_THRESHOLD = -25.0`   # 진입가 대비 -25% 도달 시 즉시 손절
- `TS_ACTIVATION_THRESHOLD = 25.0` # 수익률 +25% 도달 시 트레일링 감시 활성화
- `TS_CALLBACK_RATE = 10.0`       # 최고점(Peak) 대비 10% 하락 시 익절 매도
- `CHECK_INTERVAL = 300`          # 감시 주기 (5분/300초)

### [실행 프로세스 (5분 단위)]
1. **상태 1: 관망 및 손절 감시 (Initial State)**
   - 수익률이 `-25%` 이하인 경우: 즉시 시장가 매도 후 상태 초기화(`idle`).
   - 수익률이 `+25%` 이상인 경우: `is_ts_active` 상태를 `True`로 전환하고 현재가를 `peak_price`로 기록.
2. **상태 2: 트레일링 추격 (Trailing State)**
   - 현재가가 기존 `peak_price`보다 높으면 `peak_price`를 최신화.
   - 현재가가 `peak_price` 대비 10% 하락 시 (`current <= peak_price * 0.9`): 즉시 시장가 매도 및 상태 초기화.

---

## 3. 백테스트 엔진 구현 (tests/backtester.py)
✅ **구현 완료** (2026-02-14): `tests/backtester.py`, `run_backtest.py`

에이전트는 실전 로직과 100% 동기화된 백테스트 엔진을 작성할 것.

### [시뮬레이션 조건]
- **초기 자산**: 100.0 USDT (회당 베팅액 5.1 USDT 고정).
- **데이터 소스**: MEXC 과거 5분봉(OHLCV) 데이터 사용.
- **거래 비용**: 진입/청산 시 슬리피지 및 수수료 포함 총 0.3% 차감 반영.
- **지속성**: 잔고가 5.1 USDT 미만이 되어도 시뮬레이션을 중단하지 않고 전체 분석 기간을 완주할 것 (마이너스 잔고 허용).

### [중점 분석 사항]
- **데이터 정밀도**: 캔들의 종가뿐만 아니라 **High/Low** 값을 기준으로 손절/익절/트레일링 조건을 체크해야 함.
- **주기별 비교 분석**: 베팅 유지 시간(`BETTING_DURATION`)을 **48시간, 72시간, 96시간**으로 각각 설정하여 결과값 비교.

---

## 4. 최종 리포트 출력 항목 (Key Metrics)

### A. 생존 가성비 분석 (Survival Analysis)
- **최대 생존 일수**: 추가 시드 보충 없이 100 USDT로 가장 오랫동안 버틴 주기는?
- **파산 지점 기록**: 잔고가 처음으로 5.1 USDT 미만으로 떨어진 시점과 그때까지의 베팅 횟수.

### B. 수익성 및 변동성 분석
- **자산 최고점(ATH)**: 전략 가동 중 잔고가 가장 높았던 금액과 그 시점.
- **최대 잭팟**: 트레일링 스탑을 통해 기록한 단일 종목 최고 수익률 기록.

### C. 최종 전략 제안
- 사용자의 시드 보충 부담(현금 흐름)을 최소화하면서도 수익을 낼 수 있는 가장 최적의 베팅 주기를 추천할 것.
- 코인선택이 랜덤이라 어차피 이 백테스트는 재현성이 없다. 다만 여러 번 수행시에 어떤 경향을 보이는지 분석할 수 있게 해줘.

---

## 5. 구현 완료 사항 (2026-02-14)

### 실전 로직 구현
- `core/config.py`: 손절/익절 설정 추가
- `core/state_manager.py`: 트레일링 상태 관리
- `core/scheduler_engine.py`: 5분마다 손절/익절/타임아웃 체크

### 백테스트 엔진 구현
- `tests/backtester.py`: 핵심 백테스트 엔진
  - `BacktestConfig`: 전략 설정 (실전과 동일)
  - `Position`: 포지션 및 트레일링 상태 관리
  - `Trade`: 거래 기록 및 PNL 계산 (거래 비용 반영)
  - `BacktestEngine`: 시뮬레이션 실행
    - MEXC API로 5분봉 데이터 다운로드
    - High/Low 기준 손절/익절 체크
    - 마이너스 잔고 허용 (전체 기간 분석)
    - 다중 주기 비교 (48h, 72h, 96h)
- `run_backtest.py`: CLI 실행 스크립트
- `tests/README.md`: 백테스트 가이드

### 사용법
```bash
# 기본 실행
python run_backtest.py BTC/USDT 2024-01-01 2024-12-31

# 주기 커스터마이징
python run_backtest.py ETH/USDT 2024-06-01 2024-12-31 --cycles 24,48,72,96
```

### 다음 작업
- 실제 과거 데이터로 백테스트 실행
- 48h/72h/96h 최적 주기 검증
- 결과 분석 및 전략 조정

→ **✅ 완료**: Binance 13개월 백테스트 완료 (2026-02-14)
→ **최종 결정**: 72h 주기 선택 (재미 + 생존 기간 균형)